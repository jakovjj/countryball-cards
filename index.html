<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://www.redditstatic.com https://ads.reddit.com https://ipapi.co https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://unpkg.com https://cdn.emailjs.com; connect-src 'self' https://www.redditstatic.com https://ads.reddit.com https://ipapi.co https://pixel-config.reddit.com https://conversions-config.reddit.com https://events.reddit.com https://www.google-analytics.com https://region1.google-analytics.com https://stats.g.doubleclick.net https://www.googletagmanager.com https://discord.com https://www.reddit.com https://api.emailjs.com; img-src 'self' data: https:;">\n  <title>Join Newsletter - Countryball Cards</title>
  <meta name="description" content="Sign up for Countryball Cards newsletter to get notified when we launch on Kickstarter October 1st!" />
  <link rel="canonical" href="https://countryballcards.com/" />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#151515" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://countryballcards.com/">
  <meta property="og:title" content="Join Newsletter - Countryball Cards">
  <meta property="og:description" content="Sign up for Countryball Cards newsletter to get notified when we launch on Kickstarter October 1st!">
  <meta property="og:image" content="https://countryballcards.com/logo.png">
  <meta property="og:site_name" content="Countryball Cards">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://countryballcards.com/">
  <meta property="twitter:title" content="Join Newsletter - Countryball Cards">
  <meta property="twitter:description" content="Sign up for Countryball Cards newsletter to get notified when we launch on Kickstarter October 1st!">
  <meta property="twitter:image" content="https://countryballcards.com/logo.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" sizes="any" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  
  <!-- Performance hints -->
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <link rel="preconnect" href="https://www.redditstatic.com" crossorigin>
  <link rel="preconnect" href="https://ads.reddit.com" crossorigin>
  <link rel="dns-prefetch" href="https://api.emailjs.com">
  <link rel="dns-prefetch" href="https://pixel-config.reddit.com">
  <link rel="dns-prefetch" href="https://events.reddit.com">
  
  <!-- Google tag (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M366HCYL8Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-M366HCYL8Z', {
      transport_type: 'beacon',
      anonymize_ip: true,
      allow_google_signals: false
    });
  </script>
  
  <link rel="stylesheet" href="styles.css?v=2025081801">

  <!-- EmailJS SDK - Multiple CDN fallbacks for reliability -->
  <script>
    // Global variable to track EmailJS loading state
    window.emailJSReady = false;
    
    // Function to load EmailJS with fallbacks
    function loadEmailJS() {
      return new Promise((resolve, reject) => {
        const cdns = [
          'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js',
          'https://unpkg.com/@emailjs/browser@3/dist/email.min.js',
          'https://cdn.emailjs.com/dist/email.min.js'
        ];
        
        let cdnIndex = 0;
        
        function tryLoadFromCDN() {
          if (cdnIndex >= cdns.length) {
            reject(new Error('All EmailJS CDNs failed to load'));
            return;
          }
          
          const script = document.createElement('script');
          script.src = cdns[cdnIndex];
          script.async = false;
          
          script.onload = function() {
            console.log(`EmailJS loaded successfully from CDN ${cdnIndex + 1}:`, cdns[cdnIndex]);
            
            setTimeout(() => {
              if (typeof emailjs !== 'undefined' && emailjs.init) {
                try {
                  emailjs.init("hvatz7pPDbme6A77h");
                  window.emailJSReady = true;
                  console.log('EmailJS initialized successfully');
                  resolve(true);
                } catch (error) {
                  console.error('EmailJS init failed:', error);
                  reject(error);
                }
              } else {
                console.warn('EmailJS loaded but not available, trying next CDN...');
                cdnIndex++;
                tryLoadFromCDN();
              }
            }, 100);
          };
          
          script.onerror = function() {
            console.warn(`Failed to load EmailJS from CDN ${cdnIndex + 1}:`, cdns[cdnIndex]);
            cdnIndex++;
            tryLoadFromCDN();
          };
          
          document.head.appendChild(script);
        }
        
        tryLoadFromCDN();
      });
    }
    
    // Initialize EmailJS when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Starting EmailJS initialization...');
      loadEmailJS()
        .then(() => {
          console.log('EmailJS ready for use');
        })
        .catch(error => {
          console.error('EmailJS failed to load from all sources:', error);
          window.emailJSReady = false;
        });
    });
  </script>

  <style>
    /* Custom styles for join page */
    .join-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 28px;
      box-sizing: border-box;
    }
    
    .join-content {
      background: var(--card);
      border: 3px solid var(--gold);
      border-radius: 18px;
      padding: 24px;
      max-width: 360px;
      width: 100%;
      text-align: center;
      box-sizing: border-box;
    }
    
    .join-logo {
      max-width: 140px;
      height: auto;
      margin: 0 auto 16px;
      display: block;
    }
    
    .join-title {
      font-size: clamp(22px, 4vw, 28px);
      color: var(--text);
      margin: 0 0 12px;
      font-weight: 700;
    }
    
    .join-subtitle {
      color: var(--muted);
      margin: 0 0 20px;
      font-size: 14px;
      line-height: 1.3;
    }
    
    .success-message {
      display: none;
      background: rgba(40, 167, 69, 0.1);
      border: 2px solid rgba(40, 167, 69, 0.5);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      color: #28a745;
      font-size: 14px;
      font-weight: 600;
    }
    
    .success-message.show {
      display: block;
    }
    
    .homepage-btn {
      background: var(--gold);
      color: var(--bg);
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 12px;
    }
    
    .homepage-btn:hover {
      background: #b8954a;
      transform: translateY(-2px);
    }
    
    .join-footer {
      margin-top: auto;
      padding-top: 24px;
      color: var(--muted);
      font-size: 12px;
      text-align: center;
    }
    
    .join-footer a {
      color: var(--gold);
      text-decoration: none;
    }
    
    .join-footer a:hover {
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .join-content {
        padding: 20px 16px;
      }
      
      .join-logo {
        max-width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="join-container">
    <div class="join-content">
      <img src="logo.png" alt="Countryball Cards" class="join-logo" onerror="this.style.display='none';">
      
      <div class="success-message" id="successMessage">
        <div style="font-size: 18px; margin-bottom: 6px;">ðŸŽ‰ Welcome to the Community!</div>
        <div>You'll be the first to know when we launch on Kickstarter October 1st!</div>
        
        <a href="home.html" class="homepage-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
          Go to Homepage
        </a>
      </div>
      
      <div id="emailFormContainer">
        <h1 class="join-title">ðŸš€ Join Our Newsletter</h1>
        <p class="join-subtitle">
          Get exclusive updates, early access, community news, and free shipping to EU/US.
        </p>
        
        <!-- Email Signup Form -->
        <div class="inline-email-signup">
          <form id="joinEmailForm" class="inline-email-form">
            <div class="inline-form-group">
              <input 
                type="email" 
                id="joinEmailInput" 
                placeholder="Enter your email address" 
                required 
                autocomplete="email"
                class="inline-email-input"
              >
              <button type="submit" class="inline-email-submit" id="joinEmailSubmitBtn">
                <span class="inline-submit-text">Get Updates</span>
                <svg class="inline-submit-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
              </button>
            </div>
            <div class="inline-form-message" id="joinFormMessage"></div>
          </form>
        </div>
        
        <div class="privacy-notice" style="font-size:10px;color:var(--muted);margin-top:12px">
          By subscribing, you agree to our <a href="privacy-policy.html" style="color:var(--gold);text-decoration:none">Privacy Policy</a>
        </div>
      </div>
    </div>
    
    <div class="join-footer">
      Â© 2025 Glare Studios â€¢ Made for fans of countryballs & strategy.<br>
      <a href="privacy-policy.html">Privacy Policy</a> â€¢ 
      <a href="terms-and-conditions.html">Terms & Conditions</a>
    </div>
  </div>

  <script>
    // Email form functionality for join page
    document.addEventListener('DOMContentLoaded', function() {
      const joinEmailForm = document.getElementById('joinEmailForm');
      const joinEmailInput = document.getElementById('joinEmailInput');
      const joinSubmitBtn = document.getElementById('joinEmailSubmitBtn');
      const joinFormMessage = document.getElementById('joinFormMessage');
      const successMessage = document.getElementById('successMessage');
      const emailFormContainer = document.getElementById('emailFormContainer');
      
      if (!joinEmailForm || !joinEmailInput || !joinSubmitBtn || !joinFormMessage) {
        return;
      }
      
      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }
      
      function showMessage(message, type) {
        joinFormMessage.className = `inline-form-message ${type}`;
        joinFormMessage.textContent = message;
      }
      
      function showSuccess() {
        emailFormContainer.style.display = 'none';
        successMessage.classList.add('show');
        
        // Track successful signup
        try {
          if (window.rdt) {
            rdt('track', 'SignUp', {
              event_name: 'EmailSignup',
              content_name: 'Newsletter',
              content_category: 'Email Marketing',
              content_ids: ['join_page_signup'],
              content_type: 'signup'
            });
          }
        } catch (_) {}
        
        try {
          if (window.gtag) {
            gtag('event', 'email_signup', {
              event_category: 'conversion',
              event_label: 'join_page',
              value: 1
            });
          }
        } catch (_) {}
      }
      
      async function handleSubmit(e) {
        e.preventDefault();
        
        const email = joinEmailInput.value.trim();
        
        if (!email) {
          showMessage('Please enter your email address.', 'error');
          joinEmailInput.focus();
          return;
        }
        
        if (!validateEmail(email)) {
          showMessage('Please enter a valid email address.', 'error');
          joinEmailInput.focus();
          return;
        }
        
        // Show loading state
        joinSubmitBtn.disabled = true;
        joinSubmitBtn.classList.add('loading');
        showMessage('', '');
        
        try {
          // Check if EmailJS is ready
          if (!window.emailJSReady || typeof emailjs === 'undefined' || !emailjs.send) {
            console.log('EmailJS not ready, waiting...');
            showMessage('Connecting to email service...', 'info');
            
            // Wait for EmailJS to load
            let waitAttempts = 0;
            const maxWaitAttempts = 10;
            
            while (waitAttempts < maxWaitAttempts && (!window.emailJSReady || typeof emailjs === 'undefined' || !emailjs.send)) {
              await new Promise(resolve => setTimeout(resolve, 1000));
              waitAttempts++;
            }
            
            if (!window.emailJSReady || typeof emailjs === 'undefined' || !emailjs.send) {
              throw new Error('EmailJS service failed to load. Please refresh the page and try again.');
            }
            
            showMessage('', '');
          }
          
          // Check for duplicate emails locally first
          const emails = JSON.parse(localStorage.getItem('countryball_emails') || '[]');
          
          if (emails.includes(email)) {
            showSuccess();
          } else {
            // Send email via EmailJS
            const templateParams = {
              from_name: email,
              from_email: email,
              to_name: 'Countryball Cards Team',
              message: `New newsletter signup from ${email} (join page)`,
              signup_date: new Date().toLocaleString(),
              source_page: 'Join Page',
              user_email: email,
              reply_to: email
            };

            console.log('Sending email with EmailJS...');
            const result = await emailjs.send(
              'service_icdib4n',
              'template_j6fy2w2', 
              templateParams
            );

            if (result.status === 200) {
              // Store email locally to prevent duplicates
              emails.push(email);
              localStorage.setItem('countryball_emails', JSON.stringify(emails));
              
              showSuccess();
              console.log('Email sent successfully via EmailJS');
            } else {
              throw new Error('Failed to send email');
            }
          }
        } catch (error) {
          console.error('Email signup error:', error);
          showMessage('Something went wrong. Please try again later.', 'error');
        } finally {
          // Reset button state
          joinSubmitBtn.disabled = false;
          joinSubmitBtn.classList.remove('loading');
        }
      }
      
      joinEmailForm.addEventListener('submit', handleSubmit);
      
      // Focus effects
      joinEmailInput.addEventListener('focus', function() {
        this.style.boxShadow = '0 0 0 4px rgba(199, 164, 85, 0.3)';
      });
      
      joinEmailInput.addEventListener('blur', function() {
        this.style.boxShadow = '';
      });
    });
  </script>

  <!-- Analytics and Reddit Pixel -->
  <script>
    // Reddit Pixel bootstrap - Enhanced version
    (function(w,d){
      if(!w.rdt){
        var p=w.rdt=function(){
          p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments);
        };
        p.callQueue=[];

        var isValidDomain=function(){
          var h=w.location.hostname;
          return h!=='localhost' && h!=='127.0.0.1' && h!=='' && !h.endsWith('.local') &&
                 !h.startsWith('192.168.') && !h.startsWith('10.') && !h.startsWith('172.') &&
                 h.indexOf('.')>-1 && (w.location.protocol==='https:' || w.location.protocol==='http:');
        };

        if(isValidDomain()){
          var t=d.createElement('script');
          t.src='https://www.redditstatic.com/ads/pixel.js';
          t.async=true;
          t.crossOrigin='anonymous';
          t.referrerPolicy='no-referrer-when-downgrade';
          t.setAttribute('data-nonce', '');
          t.onerror=function(e){
            console.warn('Reddit pixel failed to load:', e);
            if(!w.rdt.sendEvent){ 
              w.rdt = function(){ console.log('Reddit pixel fallback called with:', arguments); }; 
              w.rdt.sendEvent=w.rdt; 
            }
          };
          t.onload=function(){
            console.log('Reddit pixel loaded successfully');
          };
          var firstScript = d.getElementsByTagName('script')[0];
          if(firstScript && firstScript.parentNode){
            firstScript.parentNode.insertBefore(t, firstScript);
          } else {
            d.head.appendChild(t);
          }
        } else {
          console.log('Invalid domain for Reddit pixel, using mock');
          w.rdt=function(){ console.log('Reddit pixel mock called with:', arguments); }; 
          w.rdt.sendEvent=w.rdt;
        }
      }
    })(window,document);

    // Init Reddit pixel with better error handling
    function initRedditPixel() {
      var h=location.hostname;
      var ok = h && h.indexOf('.')>-1 && h!=='localhost' && h!=='127.0.0.1' && !h.endsWith('.local');
      if(!ok) {
        console.log('Skipping Reddit pixel init - invalid domain');
        return;
      }
      
      try{
        console.log('Initializing Reddit pixel...');
        rdt('init','a2_hgzcstbb8534',{ 
          optOut:false, 
          useDecimalCurrencyValues:true, 
          debug:true 
        });
        console.log('Reddit pixel initialized');
        
        rdt('track','PageVisit');
        console.log('Reddit pixel PageVisit tracked');
      }catch(e){ 
        console.error('Reddit pixel initialization failed:', e);
      }
    }

    // Try to init after delays
    setTimeout(initRedditPixel, 500);
    setTimeout(initRedditPixel, 2000);
    
    // Also try on page load
    if(document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initRedditPixel, 1000);
      });
    }
  </script>
  </script>
</body>
</html>
