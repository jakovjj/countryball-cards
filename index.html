<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://www.redditstatic.com https://tally.so https://ipapi.co; connect-src 'self' https://www.redditstatic.com https://ipapi.co https://pixel-config.reddit.com https://conversions-config.reddit.com https://ads.reddit.com https://events.reddit.com; img-src 'self' data: https:; frame-src https://tally.so;">
  <title>Countryball Cards</title>
  <meta name="description" content="Strategy card game inspired by countryballs. Download the free print-and-play and join the Kickstarter prelaunch." />
  <meta property="og:title" content="Countryball Cards" />
  <meta property="og:description" content="Grab the free print-and-play and join the prelaunch." />
  <meta property="og:type" content="website" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  
  <style>
    :root { --bg:#151515; --card:#1d1d1d; --gold:#c7a455; --text:#eee; --muted:#b7b7b7; }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,Segoe UI,Inter,Arial;overflow-x:hidden}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    .frame{border:3px solid var(--gold);border-radius:18px;padding:28px}
    h1{font-size: clamp(34px,5.2vw,56px);letter-spacing:1px;margin:8px 0 6px}
    .logo{max-width:100%;height:auto;max-height:200px;margin:8px 0 6px;display:block}
    .logo-fallback{display:none}
    .sub{color:var(--muted);margin:0 0 18px}
    .badges{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 22px}
    .badge{color:var(--gold);background:rgba(199,164,85,.15);
           border-radius:4px;padding:6px 12px;font-weight:600;font-size:14px;
           text-transform:uppercase;letter-spacing:0.5px;
           transform:rotate(-2deg);transform-origin:center;
           box-shadow:0 2px 6px rgba(0,0,0,.2);
           position:relative;display:inline-block}
    .badge:nth-child(even){transform:rotate(1.5deg)}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(12,1fr);align-items:center}
    .hero{grid-column:1/-1;display:grid;gap:16px;grid-template-columns:repeat(12,1fr)}
    .art{grid-column:1/13;display:flex;justify-content:center;align-items:center}
    .card{background:transparent;
          border:none;
          box-shadow:0 4px 12px rgba(0,0,0,.25), 
                     0 0 8px rgba(199,164,85,.2);
          border-radius:0;overflow:visible;
          background:none;
          transition:transform 0.15s ease-out, box-shadow 0.15s ease-out;
          transform-style:preserve-3d;cursor:pointer;
          transform-origin:center center;position:relative;z-index:10;
          will-change:transform;
          backface-visibility:hidden;
          -webkit-backface-visibility:hidden}
    .card:hover{box-shadow:0 12px 25px rgba(0,0,0,.4), 
                           0 0 20px rgba(199,164,85,.3)}
    .card img{width:100%;height:100%;display:block;
              image-rendering:auto;image-rendering:high-quality;
              image-rendering:crisp-edges;-ms-interpolation-mode:bicubic;
              transform:translateZ(1px);object-fit:contain;
              image-rendering:-webkit-optimize-contrast;
              filter:none;-webkit-filter:none;
              backface-visibility:hidden;
              -webkit-backface-visibility:hidden;
              will-change:transform}
    
  /* Carousel Styles - responsive */
  .carousel-container{position:relative;width:min(100%, 480px);margin:0 auto;
             padding:clamp(16px,4vw,40px) clamp(16px,6vw,60px);box-sizing:border-box}
  .carousel{overflow:hidden;border-radius:0;position:relative;width:100%;
        aspect-ratio:480/620;background:transparent}
  .carousel-track{display:flex;transition:transform 0.3s ease-in-out;height:100%}
  .carousel-slide{width:100%;height:100%;flex:0 0 100%;display:flex;justify-content:center;align-items:center}
  .carousel-slide .card{width:min(85%, 373px);max-height:96%;overflow:visible;transform-style:preserve-3d;
              display:flex;justify-content:center;align-items:center;padding:0}
  .carousel-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.7);
          color:var(--gold);border:none;border-radius:50%;width:clamp(36px,8vw,40px);height:clamp(36px,8vw,40px);
          cursor:pointer;font-size:clamp(16px,4vw,18px);font-weight:bold;transition:background 0.2s;z-index:10;
          -webkit-tap-highlight-color:transparent;
          -webkit-touch-callout:none;display:flex;align-items:center;justify-content:center}
    .carousel-nav:hover{background:rgba(0,0,0,0.9)}
    .carousel-prev{left:clamp(4px,2vw,10px)}
    .carousel-next{right:clamp(4px,2vw,10px)}
    .carousel-dots{display:flex;justify-content:center;gap:clamp(6px,2vw,8px);margin-top:clamp(12px,3vw,16px);margin-bottom:clamp(20px,5vw,40px)}
  .carousel-dot{width:clamp(10px,3vw,12px);height:clamp(10px,3vw,12px);border-radius:50%;background:var(--muted);
          border:none;cursor:pointer;transition:background 0.2s;
          -webkit-tap-highlight-color:transparent}
    .carousel-dot.active{background:var(--gold)}
    
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
    .btn{appearance:none;border:none;background:transparent;color:var(--bg);
         padding:14px 18px;border-radius:12px;cursor:pointer;font-weight:800;
         display:inline-flex;align-items:center;gap:8px;text-decoration:none;
         transition:all 0.3s ease;transform:translateY(0);
         box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    .btn.primary{background:var(--gold)}
    .btn.primary:hover{background:#d4b866;transform:translateY(-2px);
                       box-shadow:0 6px 20px rgba(199,164,85,0.4),
                                  0 0 0 3px rgba(199,164,85,0.1)}
    .btn.secondary{border:2px solid var(--gold);color:var(--text)}
    .btn.secondary:hover{background:rgba(199,164,85,0.1);border-color:#d4b866;
                         transform:translateY(-2px);
                         box-shadow:0 6px 20px rgba(199,164,85,0.2),
                                    0 0 0 2px rgba(199,164,85,0.15)}
    .btn.tertiary{background:var(--text);color:var(--bg)}
    .btn.tertiary:hover{background:#f5f5f5;transform:translateY(-2px);
                        box-shadow:0 6px 20px rgba(238,238,238,0.3),
                                   0 0 0 2px rgba(238,238,238,0.2)}
    .btn-icon{width:20px;height:20px;flex-shrink:0;transition:transform 0.3s ease}
    .btn:hover .btn-icon{transform:scale(1.1)}
    .footer{margin-top:30px;color:var(--muted);font-size:14px}
    .hide-text-on-mobile{display:block}
    @media (min-width:720px){
      .hero .copy{grid-column:1/6;padding-right:8px}
      .hero .art{grid-column:6/13}
      .hide-text-on-mobile{display:inline}
    }
    @media (max-width:719px){
      .hero{grid-template-columns:1fr}
      .hero .copy{grid-column:1;text-align:center;margin-bottom:24px}
      .hero .art{grid-column:1;width:100%;display:flex;justify-content:center;align-items:center;padding:0;margin:0;min-height:clamp(420px,65vh,600px);position:relative}
      .carousel-container{width:100%;max-width:95vw;margin:0 auto;position:static;transform:none;
                         padding:clamp(20px,5vw,40px) clamp(8px,3vw,16px);box-sizing:border-box}
      .carousel{width:100%;border-radius:0;aspect-ratio:3/4}
      .carousel-slide .card{width:min(90%, 340px);max-height:98%}
      .carousel-slide .card img{max-width:100%;max-height:100%;object-fit:contain}
      .cta{justify-content:center}
      .privacy-notice{text-align:center !important}
      .wrap{padding:clamp(16px,4vw,20px)}
      .frame{padding:clamp(16px,4vw,20px)}
      .logo{max-height:clamp(120px,20vw,150px)}
      .badges{justify-content:center;margin:0 0 16px 0}
      h1{text-align:center}
      .sub{text-align:center;font-size:clamp(14px,3.5vw,16px);line-height:1.5}
    }
    
    /* Additional mobile-specific adjustments */
    @media (max-width:480px){
      .carousel-container{max-width:98vw;padding:clamp(16px,4vw,24px) clamp(4px,2vw,8px)}
      .carousel{aspect-ratio:2.5/4}
      .carousel-slide .card{width:min(92%, 320px)}
      .wrap{padding:clamp(12px,3vw,16px)}
      .frame{padding:clamp(12px,3vw,16px)}
      .cta{gap:8px}
      .btn{padding:12px 16px;font-size:14px}
      .sub{font-size:14px}
    }
    
    /* Very small screens */
    @media (max-width:360px){
      .carousel-container{padding:12px 4px}
      .carousel{aspect-ratio:2.2/4}
      .carousel-slide .card{width:94%}
      .btn{padding:10px 14px;font-size:13px}
      .badges{gap:6px}
      .badge{padding:4px 8px;font-size:12px}
    }
    
    /* Safari-specific fixes */
    @supports (-webkit-appearance:none) {
      .carousel-container{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}
      .carousel-track{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}
      .carousel-slide{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}
    }
  </style>

  <!-- Reddit Pixel -->
  <script>
  // Reddit Pixel implementation with enhanced error handling and domain validation
  !function(w,d){
    if(!w.rdt){
      var p=w.rdt=function(){
        p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)
      };
      p.callQueue=[];
      
      // Check if we're on a valid domain for Reddit pixel
      var isValidDomain = function() {
        var hostname = w.location.hostname;
        // Only allow proper production domains with TLD
        // Exclude localhost, file://, chrome-extension://, etc.
        return hostname !== 'localhost' && 
               hostname !== '127.0.0.1' && 
               hostname !== '' && 
               !hostname.endsWith('.local') &&
               !hostname.startsWith('192.168.') &&
               !hostname.startsWith('10.') &&
               !hostname.startsWith('172.') &&
               hostname.indexOf('.') > 0 && // Must have at least one dot
               hostname.indexOf('.') < hostname.length - 1 && // Dot can't be last character
               (w.location.protocol === 'https:' || w.location.protocol === 'http:'); // Allow HTTP for testing
      };
      
      // Only load Reddit pixel on valid domains
      if (isValidDomain()) {
        var t=d.createElement("script");
        t.src="https://www.redditstatic.com/ads/pixel.js";
        t.async=!0;
        t.setAttribute('crossorigin', 'anonymous');
        t.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
        
        // Enhanced error handling
        t.onerror = function(e) {
          console.warn('Reddit pixel script failed to load - this may be due to ad blockers or network issues');
          console.log('Error details:', e);
          // Create fallback tracking function that still logs events
          if (!w.rdt.sendEvent) {
            w.rdt = function() {
              console.log('Reddit pixel fallback called with:', arguments);
              // Still track events locally for debugging
              if (arguments[0] === 'track' && arguments[1]) {
                console.log('Event tracked (fallback):', arguments[1], arguments[2] || {});
              }
            };
            w.rdt.sendEvent = w.rdt;
          }
        };
        
        t.onload = function() {
          console.log('✅ Reddit pixel script loaded successfully');
        };
        
        var s=d.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(t,s);
      } else {
        console.log('Reddit pixel disabled for local/invalid domain:', w.location.hostname);
        // Create a mock function for local testing
        w.rdt = function() {
          console.log('Reddit pixel (local mock) called with:', arguments);
        };
        w.rdt.sendEvent = w.rdt;
      }
    }
  }(window,document);
  
  // Initialize pixel with enhanced error handling
  setTimeout(function() {
    var hostname = window.location.hostname;
    var isValidDomain = hostname !== 'localhost' && 
        hostname !== '127.0.0.1' && 
        hostname !== '' &&
        !hostname.endsWith('.local') &&
        hostname.indexOf('.') > -1;
        
    if (isValidDomain) {
      try {
        console.log('Initializing Reddit pixel for domain:', hostname);
        rdt('init','a2_hgzcstbb8534', {
          optOut: false,
          useDecimalCurrencyValues: true,
          debug: true // Enable debug mode for better troubleshooting
        });
        console.log('✅ Reddit pixel initialized');
        
        rdt('track', 'PageVisit');
        console.log('✅ PageVisit event tracked');
      } catch (error) {
        console.error('❌ Reddit pixel initialization error:', error);
        // Ensure we still have a working function
        if (!window.rdt || typeof window.rdt !== 'function') {
          window.rdt = function() {
            console.log('Reddit pixel error fallback called with:', arguments);
          };
        }
      }
    } else {
      console.log('Reddit pixel init skipped for local domain');
    }
  }, 500); // Give the script more time to load
  
  // Enhanced verification and debugging for Event Setup Tool
  setTimeout(() => {
    console.log('=== Reddit Pixel Debug Info ===');
    console.log('Current domain:', window.location.hostname);
    console.log('Protocol:', window.location.protocol);
    console.log('Full URL:', window.location.href);
    
    // Check domain validity
    const hostname = window.location.hostname;
    const isValidDomain = hostname !== 'localhost' && 
                         hostname !== '127.0.0.1' && 
                         hostname !== '' && 
                         !hostname.endsWith('.local') &&
                         hostname.indexOf('.') > -1;
    
    console.log('Valid domain for Reddit pixel:', isValidDomain);
    console.log('Window.rdt exists:', !!window.rdt);
    console.log('Window.rdt type:', typeof window.rdt);
    
    const pixelScript = document.querySelector('script[src*="pixel.js"]');
    console.log('Pixel script loaded:', pixelScript !== null);
    
    if (pixelScript) {
      console.log('Script element found:', pixelScript.src);
      console.log('Script loaded successfully:', !pixelScript.onerror);
    }
    
    console.log('Document ready state:', document.readyState);
    console.log('No iframes detected:', window.self === window.top);
    console.log('HTTPS protocol:', window.location.protocol === 'https:');
    console.log('CSP header present:', document.querySelector('meta[http-equiv="Content-Security-Policy"]') !== null);
    
    if (window.rdt) {
      console.log('✅ Reddit pixel function available');
      console.log('Has sendEvent:', typeof window.rdt.sendEvent);
      console.log('Has callQueue:', Array.isArray(window.rdt.callQueue));
      
      // Only test pixel if on valid domain
      if (isValidDomain) {
        try {
          rdt('track', 'ViewContent', { 
            content_ids: ['debug_test'], 
            content_type: 'product',
            content_name: 'Debug Test'
          });
          console.log('✅ Test tracking call successful');
        } catch (e) {
          console.error('❌ Test tracking failed:', e);
        }
      } else {
        console.log('⚠️ Skipping test tracking call on local domain');
      }
    } else {
      console.error('❌ Reddit pixel failed to load');
    }
    
    // Check for specific errors
    const errors = [];
    if (isValidDomain) {
      if (!pixelScript) errors.push('Pixel script not found in DOM');
      if (pixelScript && !window.rdt.sendEvent) errors.push('Pixel loaded but sendEvent not available (likely ad blocker)');
      if (!window.rdt) errors.push('Pixel function not available');
    }
    
    if (errors.length > 0) {
      console.warn('⚠️ Issues detected:', errors);
    } else if (isValidDomain) {
      console.log('✅ All checks passed');
    }
    
    console.log('===============================');
  }, 3000); // Wait longer for everything to load
  </script>
  <!-- DO NOT MODIFY UNLESS TO REPLACE A USER IDENTIFIER -->
  <!-- End Reddit Pixel -->
  <!-- Tally popup (email capture). Create a form at tally.so → Share → Popup → copy ID -->
  <script async src="https://tally.so/widgets/embed.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="frame">
      <div class="hero">
        <div class="copy">
          <div class="badges">
            <div class="badge">FREE PRINT-AND-PLAY!</div>
            <div class="badge">Kickstarter prelaunch!</div>
          </div>
          <h1>
            <img src="logo.png" alt="Countryball Cards" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span class="logo-fallback">Countryball Cards</span>
          </h1>
          <p class="sub">Collect, trade, attack. Help balance new cards and pick what comes next. Free print-and-play can be found on our Discord!</p>
          <div class="cta">
            <a class="btn primary" id="discordBtn" href="https://discord.gg/GVkrHXvzf8" target="_blank" rel="noopener">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
              Join Discord
            </a>
            <a class="btn primary" id="redditBtn" href="https://reddit.com/r/countryball_cards" target="_blank" rel="noopener">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
              </svg>
              Join Subreddit
            </a>
            <button class="btn secondary" id="emailBtn"
              data-tally-open="mYAbWd" data-tally-layout="modal" data-tally-auto-close="1500">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              Get email updates
            </button>
          </div>
          <div class="privacy-notice" style="font-size:12px;color:var(--muted);margin-top:8px">
            By subscribing, you agree to our <a href="privacy-policy.html" style="color:var(--gold);text-decoration:none">Privacy Policy</a>
          </div>
        </div>

        <div class="art">
          <!-- Carousel for countryball cards -->
          <div class="carousel-container">
            <div class="carousel">
              <div class="carousel-track" id="carouselTrack">
                <!-- Cards will be generated dynamically by JavaScript -->
              </div>
              <button class="carousel-nav carousel-prev" id="prevBtn">‹</button>
              <button class="carousel-nav carousel-next" id="nextBtn">›</button>
            </div>
            <div class="carousel-dots" id="carouselDots">
              <!-- Dots will be generated dynamically by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        © 2025 Glare Studios • Made for fans of countryballs & strategy.<br>
        <a href="privacy-policy.html" style="color:var(--gold);text-decoration:none">Privacy Policy</a> • 
        <a href="terms-and-conditions.html" style="color:var(--gold);text-decoration:none">Terms & Conditions</a>
      </div>
    </div>
  </div>

  <script>
    // ===== COUNTRY DETECTION & BACKGROUND =====
    // Mapping of country codes to background images
    const countryBackgrounds = {
      'US': 'us-bg.png',
      'DE': 'germany-bg.png', 
      'CA': 'canada-bg.png',
      'NL': 'netherlands-bg.png',
      'SE': 'sweden-bg.png',
      'FR': 'france-bg.png',
      'GB': 'britain-bg.png',
      'CH': 'switzerland-bg.png',
      'PL': 'poland-bg.png'
    };

    // Function to detect user's country and set background
    async function detectCountryAndSetBackground() {
      try {
        // Using ipapi.co for country detection (free tier: 1000 requests/day)
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        const countryCode = data.country_code;
        
        console.log('Detected country:', countryCode, data.country_name);
        
        // Set background if we have an image for this country, otherwise use Poland
        let backgroundImage;
        if (countryBackgrounds[countryCode]) {
          backgroundImage = countryBackgrounds[countryCode];
          console.log('Set background for country:', countryCode);
        } else {
          backgroundImage = countryBackgrounds['PL'];
          console.log('No background image available for country:', countryCode, '- using Poland fallback');
        }

        console.log('Attempting to load background image:', backgroundImage);
        
        // Preload the image with low priority to avoid blocking critical resources
        const img = new Image();
        img.onload = () => {
          console.log('✅ Background image loaded successfully:', backgroundImage);
          // Apply the background styling only after image loads
          document.body.style.backgroundImage = `url('${backgroundImage}')`;
          document.body.style.backgroundSize = 'auto 70vh';
          document.body.style.backgroundPosition = 'top 10px right -200px';
          document.body.style.backgroundRepeat = 'no-repeat';
          document.body.style.backgroundAttachment = 'fixed';
          
          // Add subtle overlay to ensure text readability
          const overlay = document.createElement('div');
          overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(21, 21, 21, 0.95), rgba(21, 21, 21, 0.8), rgba(21, 21, 21, 0.4));
            z-index: -1;
            pointer-events: none;
          `;
          document.body.appendChild(overlay);
          console.log('Background and overlay applied');
        };
        img.onerror = () => {
          console.error('❌ Failed to load background image:', backgroundImage);
          console.log('Make sure the file exists in your project folder');
        };
        img.src = backgroundImage;

      } catch (error) {
        console.error('Could not detect country:', error);
        // Fallback: use Poland when API fails
        const backgroundImage = countryBackgrounds['PL'];
        console.log('Using Poland fallback due to API error, loading:', backgroundImage);
        
        const img = new Image();
        img.onload = () => {
          console.log('✅ Poland fallback background loaded successfully');
          document.body.style.backgroundImage = `url('${backgroundImage}')`;
          document.body.style.backgroundSize = 'auto 70vh';
          document.body.style.backgroundPosition = 'top 10px right -200px';
          document.body.style.backgroundRepeat = 'no-repeat';
          document.body.style.backgroundAttachment = 'fixed';
            
          const overlay = document.createElement('div');
          overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(21, 21, 21, 0.95), rgba(21, 21, 21, 0.8), rgba(21, 21, 21, 0.4));
            z-index: -1;
            pointer-events: none;
          `;
          document.body.appendChild(overlay);
        };
        img.onerror = () => {
          console.error('❌ Failed to load Poland fallback image:', backgroundImage);
        };
        img.src = backgroundImage;
      }
    }

    // ===== CARD CONFIGURATION =====
    // Add new cards here! Just add objects with src and alt properties
    const cardData = [
      { src: 'us.png', alt: 'United States card' },
      { src: 'canada.png', alt: 'Canada card' },
      { src: 'netherlands.png', alt: 'Netherlands card' },
      { src: 'germany.png', alt: 'Germany card' },
      { src: 'sweden.png', alt: 'Sweden card' },
      { src: 'france.png', alt: 'France card' },
      { src: 'uk.png', alt: 'United Kingdom card' },
      { src: 'switzerland.png', alt: 'Switzerland card' },
      { src: 'japan.png', alt: 'Japan card' },
      { src: 'poland.png', alt: 'Poland card' }
    ];
    
    // ===== CAROUSEL FUNCTIONALITY =====
    const track = document.getElementById('carouselTrack');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const dotsContainer = document.getElementById('carouselDots');
    
    let currentSlide = 0;
    const totalSlides = cardData.length;
    let autoScrollInterval;
    let userInteractionTimeout;
    
    // Generate carousel slides and dots dynamically based on cardData
    function initializeCarousel() {
      // Clear existing content
      track.innerHTML = '';
      dotsContainer.innerHTML = '';
      
      // Generate slides
      cardData.forEach((card, index) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
        slide.innerHTML = `<div class="card"><img alt="${card.alt}" src="${card.src}"></div>`;
        track.appendChild(slide);
        
        // Generate dots
        const dot = document.createElement('button');
        dot.className = `carousel-dot ${index === 0 ? 'active' : ''}`;
        dot.setAttribute('data-slide', index);
        dotsContainer.appendChild(dot);
      });
      
      // Apply high quality rendering immediately
      setTimeout(() => {
        initializeImageQuality();
      }, 10);
    }
    
    function getSlideWidth() {
      const carouselEl = document.querySelector('.carousel');
      if (!carouselEl) return window.innerWidth; // fallback
      return carouselEl.clientWidth; // responsive width
    }

    function updateCarousel() {
      const translateX = -currentSlide * getSlideWidth();
      track.style.transform = `translateX(${translateX}px)`;
      
      // Update dots
      const dots = document.querySelectorAll('.carousel-dot');
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });
      
      // Reinitialize 3D effects for new visible card
      setTimeout(() => {
        init3DCardEffects();
      }, 50);
    }
    
    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateCarousel();
    }
    
    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateCarousel();
    }
    
    // Handle user interaction - pause auto-scroll for 10 seconds
    function handleUserInteraction() {
      // Clear existing timeout
      if (userInteractionTimeout) {
        clearTimeout(userInteractionTimeout);
      }
      
      // Clear auto-scroll interval
      if (autoScrollInterval) {
        clearInterval(autoScrollInterval);
      }
      
      // Restart auto-scroll after 10 seconds
      userInteractionTimeout = setTimeout(() => {
        startAutoScroll();
      }, 10000);
    }
    
    // Start auto-scroll functionality
    function startAutoScroll() {
      autoScrollInterval = setInterval(nextSlide, 4000);
    }
    
  // Initialize carousel when page loads
  initializeCarousel();
  // Ensure initial layout is correct
  updateCarousel();
    
    // Detect country and set background
    detectCountryAndSetBackground();
    
    // Professional 3D card hover effect with mouse tracking
    function init3DCardEffects() {
      const cards = document.querySelectorAll('.carousel-slide .card');
      
      cards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          // More subtle rotation (max 12 degrees for better quality)
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          const rotateX = ((y - centerY) / centerY) * -12; // Reduced for better quality
          const rotateY = ((x - centerX) / centerX) * 12;
          
          // Gentle lift effect that varies with position
          const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
          const maxDistance = Math.sqrt(Math.pow(centerX, 2) + Math.pow(centerY, 2));
          const liftIntensity = (1 - distance / maxDistance) * 15 + 8; // Reduced lift
          
          card.style.transform = `
            perspective(1200px) 
            rotateX(${rotateX}deg) 
            rotateY(${rotateY}deg) 
            translateZ(${liftIntensity}px)
            scale(1.01)
          `;
          card.style.transition = 'none';
          card.style.transformStyle = 'preserve-3d';
          
          // Maintain crisp rendering during transform
          const img = card.querySelector('img');
          if (img) {
            img.style.imageRendering = 'auto';
            img.style.filter = 'none';
            img.style.transform = 'translateZ(1px)';
            img.style.backfaceVisibility = 'hidden';
            img.style.webkitBackfaceVisibility = 'hidden';
          }
        });
        
        card.addEventListener('mouseleave', () => {
          card.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
          card.style.transform = 'perspective(1200px) rotateX(0deg) rotateY(0deg) translateZ(0px) scale(1)';
          
          // Maintain crisp rendering
          const img = card.querySelector('img');
          if (img) {
            img.style.imageRendering = 'auto';
            img.style.filter = 'none';
            img.style.transform = 'translateZ(0)';
            img.style.backfaceVisibility = 'hidden';
            img.style.webkitBackfaceVisibility = 'hidden';
          }
        });
        
        // Reset on carousel change
        card.addEventListener('transitionstart', () => {
          card.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
          card.style.transform = 'perspective(1200px) rotateX(0deg) rotateY(0deg) translateZ(0px) scale(1)';
        });
      });
    }
    
    // Initialize 3D effects after a short delay to ensure cards are loaded
    setTimeout(() => {
      init3DCardEffects();
      // Force high quality rendering from the start
      initializeImageQuality();
    }, 100);
    
    // Function to ensure images start with high quality
    function initializeImageQuality() {
      const images = document.querySelectorAll('.carousel-slide .card img');
      images.forEach(img => {
        img.style.imageRendering = 'auto';
        img.style.filter = 'none';
        img.style.transform = 'translateZ(1px)';
        img.style.backfaceVisibility = 'hidden';
        img.style.webkitBackfaceVisibility = 'hidden';
      });
    }
    
    // Event listeners
    nextBtn.addEventListener('click', () => {
      nextSlide();
      handleUserInteraction();
    });
    prevBtn.addEventListener('click', () => {
      prevSlide();
      handleUserInteraction();
    });
    
    // Add event listeners to dynamically created dots
    dotsContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('carousel-dot')) {
        currentSlide = parseInt(e.target.getAttribute('data-slide'));
        updateCarousel();
        handleUserInteraction();
      }
    });
    
    // Start auto-scroll when page loads
    startAutoScroll();

    // Handle resize to keep slides aligned on orientation/screen changes
    let resizeRaf;
    window.addEventListener('resize', () => {
      if (resizeRaf) cancelAnimationFrame(resizeRaf);
      resizeRaf = requestAnimationFrame(() => {
        updateCarousel();
      });
    });
    
    // Touch/swipe support for mobile
    let touchStartX = 0;
    let touchEndX = 0;
    let isSwiping = false;
    
    const carousel = document.querySelector('.carousel');
    
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
      isSwiping = true;
    }, { passive: true });
    
    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      if (isSwiping) {
        handleSwipe();
        isSwiping = false;
      }
    }, { passive: true });
    
    function handleSwipe() {
      const swipeThreshold = 50; // Minimum distance for a swipe
      const swipeDistance = touchEndX - touchStartX;
      
      if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0) {
          // Swipe right - go to previous slide
          prevSlide();
          handleUserInteraction();
        } else {
          // Swipe left - go to next slide
          nextSlide();
          handleUserInteraction();
        }
      }
    }
    
    // Fire conversion events when users click CTAs
    // Using Lead events for community engagement (no purchase required)
    document.getElementById('discordBtn').addEventListener('click', function(e){
      e.preventDefault(); // Prevent immediate navigation
      console.log('Discord button clicked - firing Reddit pixel');
      
      if (window.rdt && typeof window.rdt === 'function') {
        try {
          // Use Lead event for Discord community join
          rdt('track', 'Lead', {
            event_name: 'DiscordJoin',
            content_name: 'Discord Community',
            content_category: 'Community',
            content_ids: ['discord_join'],
            content_type: 'community'
          });
          console.log('✅ Reddit pixel fired for Discord click (Lead event)');
          
          // Also fire a Custom event as backup
          rdt('track', 'Custom', {
            customEventName: 'DiscordJoin',
            content_name: 'Discord Community'
          });
          console.log('✅ Reddit pixel backup Custom event fired');
          
        } catch (error) {
          console.error('❌ Reddit pixel error:', error);
        }
      } else {
        console.warn('❌ Reddit pixel not available or not a function');
        console.log('Pixel state:', {
          exists: !!window.rdt,
          type: typeof window.rdt,
          hasCallQueue: !!(window.rdt && window.rdt.callQueue),
          hasSendEvent: !!(window.rdt && window.rdt.sendEvent)
        });
      }
      
      // Navigate after a short delay to ensure event is sent
      setTimeout(() => {
        window.open('https://discord.gg/GVkrHXvzf8', '_blank');
      }, 400);
    });
    
    document.getElementById('redditBtn').addEventListener('click', function(e){
      e.preventDefault(); // Prevent immediate navigation
      console.log('Reddit button clicked - firing Reddit pixel');
      
      if (window.rdt && typeof window.rdt === 'function') {
        try {
          // Use Lead event for Reddit community join
          rdt('track', 'Lead', {
            event_name: 'RedditJoin',
            content_name: 'Reddit Community',
            content_category: 'Community',
            content_ids: ['reddit_join'],
            content_type: 'community'
          });
          console.log('✅ Reddit pixel fired for Reddit click (Lead event)');
          
          // Also fire a Custom event as backup
          rdt('track', 'Custom', {
            customEventName: 'RedditJoin',
            content_name: 'Reddit Community'
          });
          console.log('✅ Reddit pixel backup Custom event fired');
          
        } catch (error) {
          console.error('❌ Reddit pixel error:', error);
        }
      } else {
        console.warn('❌ Reddit pixel not available or not a function');
        console.log('Pixel state:', {
          exists: !!window.rdt,
          type: typeof window.rdt,
          hasCallQueue: !!(window.rdt && window.rdt.callQueue),
          hasSendEvent: !!(window.rdt && window.rdt.sendEvent)
        });
      }
      
      // Navigate after a short delay to ensure event is sent
      setTimeout(() => {
        window.open('https://reddit.com/r/countryball_cards', '_blank');
      }, 400);
    });
    
    document.getElementById('emailBtn').addEventListener('click', function(){
      console.log('Email button clicked - firing Reddit pixel');
      if (window.rdt && typeof window.rdt === 'function') {
        try {
          // Keep SignUp as it's working
          rdt('track', 'SignUp', {
            event_name: 'EmailSignup',
            content_name: 'Newsletter',
            content_category: 'Email Marketing',
            content_ids: ['email_signup'],
            content_type: 'signup'
          });
          console.log('✅ Reddit pixel fired for Email signup (SignUp event)');
          
          // Also fire a Custom event as backup
          rdt('track', 'Custom', {
            customEventName: 'EmailSignup',
            content_name: 'Newsletter'
          });
          console.log('✅ Reddit pixel backup Custom event fired');
          
        } catch (error) {
          console.error('❌ Reddit pixel error:', error);
        }
      } else {
        console.warn('❌ Reddit pixel not available or not a function');
        console.log('Pixel state:', {
          exists: !!window.rdt,
          type: typeof window.rdt,
          hasCallQueue: !!(window.rdt && window.rdt.callQueue),
          hasSendEvent: !!(window.rdt && window.rdt.sendEvent)
        });
      }
    });
  </script>
</body>
</html>
